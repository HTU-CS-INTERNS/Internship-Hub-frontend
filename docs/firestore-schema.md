
# InternHub - Firestore Database Schema

This document outlines a conceptual NoSQL database schema for the InternHub application using Cloud Firestore.

## General Notes:

*   **IDs**: Document IDs are typically auto-generated by Firestore unless a specific, unique ID is natural (e.g., `userId` from Firebase Auth).
*   **Timestamps**: Use Firestore Server Timestamps (`FieldValue.serverTimestamp()`) for `createdAt` and `updatedAt` fields.
*   **References**: Document references (`firebase.firestore.DocumentReference`) can be used for relationships, but consider denormalization for read efficiency.
*   **Denormalization**: Some data might be duplicated across collections to optimize read queries and reduce the need for complex joins (which don't exist in the same way as SQL).
*   **Security Rules**: Firestore security rules are crucial for controlling access to data and should be designed alongside the schema.
*   **Scalability**: Consider sharding or other strategies if any collection is expected to grow extremely large or have very high write rates to a single document.

---

## Top-Level Collections:

### 1. `users`
   Stores information about all users. Document ID: `auth.currentUser.uid`.

*   `userId` (STRING) - PK, Matches Firebase Auth UID
*   `name` (STRING) - Not Null
*   `email` (STRING) - Not Null, Unique (enforced by Firebase Auth)
*   `role` (STRING ENUM: 'STUDENT', 'LECTURER', 'SUPERVISOR', 'HOD', 'ADMIN') - Not Null
*   `avatarUrl` (STRING, optional)
*   `contactNumber` (STRING, optional)
*   `facultyId` (STRING, optional) - Reference to `faculties` collection ID (denormalize `facultyName` if needed for display)
*   `departmentId` (STRING, optional) - Reference to `departments` collection ID (denormalize `departmentName` if needed)
*   `companyName` (STRING, optional) - (for Supervisor)
*   `companyAddress` (STRING, optional) - (for Supervisor)
*   `status` (STRING ENUM: 'ACTIVE', 'INACTIVE', 'PENDING_VERIFICATION') - Not Null, Default: 'PENDING_VERIFICATION'
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 2. `faculties`
   Stores university faculties. Document ID can be a unique code or auto-generated.

*   `facultyCode` (STRING) - Not Null, Unique (e.g., "FENG")
*   `name` (STRING) - Not Null (e.g., "Faculty of Engineering")
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 3. `departments`
   Stores university departments. Document ID can be a unique code or auto-generated.

*   `departmentCode` (STRING) - Not Null, Unique (e.g., "DCOMSC")
*   `name` (STRING) - Not Null (e.g., "Department of Computer Science")
*   `facultyId` (STRING) - Not Null, Reference to `faculties` collection ID
*   `facultyName` (STRING, denormalized for display) - Not Null
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 4. `internshipPlacements`
   Stores details about a student's internship placement. Document ID could be `studentId` if one active placement per student, or auto-generated.

*   `studentId` (STRING) - Not Null, Reference to `users` collection ID
*   `studentName` (STRING, denormalized for display)
*   `studentEmail` (STRING, denormalized)
*   `facultyId` (STRING, denormalized)
*   `departmentId` (STRING, denormalized)
*   `companyName` (STRING) - Not Null
*   `companyAddress` (STRING, optional)
*   `companySupervisorName` (STRING) - Not Null
*   `companySupervisorEmail` (STRING) - Not Null
*   `startDate` (STRING - ISO 8601 YYYY-MM-DD or TIMESTAMP) - Not Null
*   `endDate` (STRING - ISO 8601 YYYY-MM-DD or TIMESTAMP) - Not Null
*   `locationDetails` (STRING, optional) - e.g., "Remote", "Office Address".
*   `status` (STRING ENUM: 'NOT_SUBMITTED', 'PENDING_APPROVAL', 'APPROVED', 'REJECTED') - Not Null, Default: 'NOT_SUBMITTED'
*   `rejectionReason` (STRING, optional) - If status is 'REJECTED'
*   `hodComments` (STRING, optional) - Comments from HOD during approval
*   `submittedAt` (TIMESTAMP, optional)
*   `approvedAt` (TIMESTAMP, optional)
*   `lecturerId` (STRING, optional) - Assigned lecturer ID
*   `supervisorId` (STRING, optional) - Industrial supervisor user ID (if they have an account)
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 5. `dailyEntries` (Alternative to separate task/report collections for easier querying by date/student)
   Stores daily tasks AND reports for students. Document ID: auto-generated.
   This combines tasks and reports for simpler timeline views. If tasks and reports have very different structures or query needs, separate collections might be better.

*   `studentId` (STRING) - Not Null, Reference to `users` collection ID
*   `entryDate` (STRING - ISO 8601 YYYY-MM-DD or TIMESTAMP) - Not Null
*   `type` (STRING ENUM: 'TASK', 'REPORT') - Not Null
*   `description` (STRING) - Not Null
*   `outcomes` (STRING, optional for task, required for report)
*   `learningObjectives` (STRING) - Not Null
*   `departmentOutcomeLink` (STRING, optional)
*   `status` (STRING ENUM: 'PENDING', 'SUBMITTED', 'APPROVED', 'REJECTED') - Not Null
*   `supervisorComments` (STRING, optional)
*   `lecturerComments` (STRING, optional)
*   `submittedAt` (TIMESTAMP, optional)
*   `approvedBySupervisorAt` (TIMESTAMP, optional)
*   `approvedByLecturerAt` (TIMESTAMP, optional)
*   `attachments` (ARRAY of MAPS, optional)
    *   `fileName` (STRING)
    *   `fileUrl` (STRING) - Cloud Storage URL
    *   `fileType` (STRING, optional) - MIME type
*   `reportTitle` (STRING, optional, only for type='REPORT')
*   `challengesFaced` (STRING, optional, only for type='REPORT')
*   `securePhotoUrl` (STRING, optional, only for type='REPORT')
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

    _Subcollections (if preferred over embedding attachments directly):_
    *   `dailyEntries/{entryId}/attachments/{attachmentId}`
        *   `fileName`, `fileUrl`, `fileType`, `uploadedAt`

---

### 6. `chats`
   Represents a communication channel between users. Document ID: auto-generated.

*   `participantIds` (ARRAY of STRINGS) - User IDs of participants (e.g., `[studentId, lecturerId]`). Indexed for querying.
*   `participantInfo` (MAP, denormalized for display, optional)
    *   `{userId}: { name, avatarUrl }`
*   `lastMessage` (MAP, optional)
    *   `content` (STRING)
    *   `timestamp` (TIMESTAMP)
    *   `senderId` (STRING)
*   `unreadCounts` (MAP, optional) - Stores unread message count for each participant.
    *   `{userId}: count` (NUMBER)
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP) - When the last message was sent.

    _Subcollection:_
    *   `chats/{chatId}/messages/{messageId}` (Ordered by timestamp)
        *   `senderId` (STRING) - Not Null
        *   `senderName` (STRING, denormalized)
        *   `content` (STRING) - Not Null
        *   `timestamp` (TIMESTAMP) - Not Null
        *   `readBy` (ARRAY of STRINGS, optional) - UserIDs who have read this message.

---

### 7. `scheduleEvents`
   Stores calendar events for users. Document ID: auto-generated.

*   `userId` (STRING) - Not Null, Owner of the event.
*   `title` (STRING) - Not Null
*   `startTime` (TIMESTAMP) - Not Null
*   `endTime` (TIMESTAMP) - Not Null
*   `type` (STRING ENUM: 'meeting', 'deadline', 'personal', 'reminder', 'visit') - Not Null
*   `description` (STRING, optional)
*   `attendeesInfo` (STRING, optional) - Comma-separated names/emails for simplicity, or could be array of userIds if internal.
*   `location` (STRING, optional) - For physical meetings or visits.
*   `isAllDay` (BOOLEAN) - Not Null, Default: `false`
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 8. `evaluations`
   Stores performance evaluations of students by lecturers or supervisors. Document ID: auto-generated.

*   `studentId` (STRING) - Not Null, Reference to `users`
*   `studentName` (STRING, denormalized)
*   `evaluatorId` (STRING) - Not Null, Reference to `users`
*   `evaluatorName` (STRING, denormalized)
*   `evaluatorRole` (STRING ENUM: 'LECTURER', 'SUPERVISOR') - Not Null
*   `evaluationDate` (STRING - ISO 8601 YYYY-MM-DD or TIMESTAMP) - Not Null
*   `overallComments` (STRING) - Not Null
*   `strengths` (STRING, optional)
*   `areasForImprovement` (STRING, optional)
*   `scores` (MAP) - Key-value pairs for metrics.
    *   `metric_key` (STRING): `score` (NUMBER 1-5) (e.g., `{"technical_skills": 4, "communication": 5}`)
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)

---

### 9. `checkIns`
   Stores student check-in records. Document ID: auto-generated.

*   `studentId` (STRING) - Not Null, Reference to `users`
*   `checkInTimestamp` (TIMESTAMP) - Not Null
*   `location` (GEOTYPE or MAP, optional)
    *   `latitude` (NUMBER)
    *   `longitude` (NUMBER)
*   `addressResolved` (STRING, optional) - Derived from GPS or manually entered.
*   `manualReason` (STRING, optional) - If GPS denied or outside geofence.
*   `isGpsVerified` (BOOLEAN) - Default: `false`
*   `isOutsideGeofence` (BOOLEAN) - Default: `false`
*   `photoUrl` (STRING, optional) - Cloud Storage URL for secure photo.
*   `supervisorVerificationStatus` (STRING ENUM: 'PENDING', 'VERIFIED', 'FLAGGED', optional)
*   `supervisorComments` (STRING, optional)
*   `createdAt` (TIMESTAMP)

---

### 10. `settings`
    Stores global and department-specific settings.
    Could be a single document `settings/system` for global, and `settings/department_{departmentId}` for department ones.

*   **Document: `settings/system`**
    *   `enableSupervisorAutoInvite` (BOOLEAN) - Default: `true`
    *   `defaultInternshipDurationWeeks` (NUMBER) - Default: 16
    *   `maxFileSizeUploadMb` (NUMBER) - Default: 10
    *   `maintenanceMode` (BOOLEAN) - Default: `false`
    *   `updatedAt` (TIMESTAMP)

*   **Document: `settings/departments/{departmentId}`** (or collection `departmentSettings/{departmentId}`)
    *   `departmentId` (STRING) - FK to `departments` collection ID (if separate collection)
    *   `departmentName` (STRING, denormalized)
    *   `autoApproveLowRiskPlacements` (BOOLEAN) - Default: `false`
    *   `minInternshipDurationWeeks` (NUMBER, optional) - Overrides system default.
    *   `customWelcomeMessage` (STRING, optional)
    *   `mandatoryReportFields` (ARRAY of STRINGS, optional) - e.g., `["challenges_faced", "learnings"]`
    *   `updatedAt` (TIMESTAMP)

---

### 11. `issues`
   Stores reported issues or grievances. Document ID: auto-generated.

*   `title` (STRING) - Not Null
*   `description` (STRING) - Not Null
*   `reportedByUserId` (STRING) - Not Null, Reference to `users`
*   `reportedByRole` (STRING ENUM: 'STUDENT', 'LECTURER', 'SUPERVISOR')
*   `reportedAt` (TIMESTAMP) - Not Null
*   `studentInvolvedId` (STRING, optional) - Reference to `users`
*   `lecturerInvolvedId` (STRING, optional) - Reference to `users`
*   `supervisorInvolvedId` (STRING, optional) - Reference to `users`
*   `departmentId` (STRING, optional) - Reference to `departments` (for HOD assignment)
*   `facultyId` (STRING, optional) - Reference to `faculties`
*   `status` (STRING ENUM: 'OPEN', 'IN_PROGRESS', 'RESOLVED', 'CLOSED') - Not Null, Default: 'OPEN'
*   `priority` (STRING ENUM: 'LOW', 'MEDIUM', 'HIGH') - Not Null, Default: 'MEDIUM'
*   `resolutionDetails` (STRING, optional)
*   `resolvedAt` (TIMESTAMP, optional)
*   `assignedToHodId` (STRING, optional) - Reference to `users` (HOD)
*   `createdAt` (TIMESTAMP)
*   `updatedAt` (TIMESTAMP)
    _Subcollection for comments/updates:_
    *   `issues/{issueId}/updates/{updateId}`
        *   `userId` (STRING)
        *   `comment` (STRING)
        *   `timestamp` (TIMESTAMP)
        *   `statusChange` (MAP, optional) `{ from: 'OLD_STATUS', to: 'NEW_STATUS' }`

---

This Firestore schema attempts to balance normalization with the typical denormalization patterns for efficient querying in NoSQL. Specific query patterns will further refine this schema during development.
    
